{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/saalem/schedulr-ai/apps/web/app/lib/api.ts"],"sourcesContent":["import { getSession } from \"next-auth/react\";\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8000\";\n\n// dev-only helper: store email in localStorage\nexport function getDevEmail() {\n  if (typeof window === \"undefined\") return null;\n  return window.localStorage.getItem(\"dev_email\");\n}\n\nasync function getAuthEmail() {\n  const session = await getSession();\n  const sessionEmail = session?.user?.email ?? null;\n  if (sessionEmail) return sessionEmail;\n\n  // Only allow dev fallback in development\n  if (process.env.NODE_ENV === \"development\") {\n    return getDevEmail();\n  }\n\n  return null;\n}\n\nexport async function apiFetch(path: string, init: RequestInit = {}) {\n  const email = await getAuthEmail();\n\n  const headers = new Headers(init.headers);\n\n  // Only set content-type when we're actually sending JSON\n  const hasBody = init.body !== undefined && init.body !== null;\n  if (hasBody && !headers.has(\"Content-Type\")) {\n    headers.set(\"Content-Type\", \"application/json\");\n  }\n\n  if (email) headers.set(\"X-User-Email\", email);\n\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...init,\n    headers,\n    cache: \"no-store\",\n  });\n\n  if (!res.ok) {\n    let detail = `HTTP ${res.status}`;\n    try {\n      const body = await res.json();\n      detail = body?.detail || JSON.stringify(body);\n    } catch {\n      try {\n        detail = await res.text();\n      } catch {}\n    }\n    throw new Error(detail);\n  }\n\n  return res;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW,6DAAoC;AAG9C,SAAS;IACd,wCAAmC,OAAO;;;AAE5C;AAEA,eAAe;IACb,MAAM,UAAU,MAAM,IAAA,4JAAU;IAChC,MAAM,eAAe,SAAS,MAAM,SAAS;IAC7C,IAAI,cAAc,OAAO;IAEzB,yCAAyC;IACzC,wCAA4C;QAC1C,OAAO;IACT;;;AAGF;AAEO,eAAe,SAAS,IAAY,EAAE,OAAoB,CAAC,CAAC;IACjE,MAAM,QAAQ,MAAM;IAEpB,MAAM,UAAU,IAAI,QAAQ,KAAK,OAAO;IAExC,yDAAyD;IACzD,MAAM,UAAU,KAAK,IAAI,KAAK,aAAa,KAAK,IAAI,KAAK;IACzD,IAAI,WAAW,CAAC,QAAQ,GAAG,CAAC,iBAAiB;QAC3C,QAAQ,GAAG,CAAC,gBAAgB;IAC9B;IAEA,IAAI,OAAO,QAAQ,GAAG,CAAC,gBAAgB;IAEvC,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QAC5C,GAAG,IAAI;QACP;QACA,OAAO;IACT;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,IAAI,SAAS,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;QACjC,IAAI;YACF,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,SAAS,MAAM,UAAU,KAAK,SAAS,CAAC;QAC1C,EAAE,OAAM;YACN,IAAI;gBACF,SAAS,MAAM,IAAI,IAAI;YACzB,EAAE,OAAM,CAAC;QACX;QACA,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/saalem/schedulr-ai/apps/web/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { apiFetch } from \"../lib/api\";\nimport { useSession, signIn } from \"next-auth/react\";\nimport { useRouter } from \"next/navigation\";\n\ntype MeBusiness = {\n  id: number;\n  name: string;\n  slug: string;\n  timezone: string;\n  created_at: string;\n  role: string;\n};\n\nasync function readJsonOrThrow(res: Response) {\n  const text = await res.text();\n  let data: any = null;\n  try {\n    data = text ? JSON.parse(text) : null;\n  } catch {}\n  if (!res.ok) {\n    const msg = data?.detail || data?.message || `HTTP ${res.status}`;\n    throw new Error(msg);\n  }\n  return data;\n}\n\nexport default function OwnerHome() {\n  const { status } = useSession();\n  const authed = status === \"authenticated\";\n\n  const [items, setItems] = useState<MeBusiness[]>([]);\n  const [err, setErr] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const router = useRouter();\n\n  useEffect(() => {\n    if (!authed) return;\n\n    (async () => {\n      setLoading(true);\n      setErr(null);\n\n      try {\n        const res = await apiFetch(\"/me/businesses\");\n        const data = (await readJsonOrThrow(res)) as MeBusiness[];\n\n        // If you want \"empty state\" instead of auto-redirect, remove this block.\n        // If you still like auto-redirect to the create page, keep it.\n        if (data.length === 0) {\n          // Option A: show empty state (recommended UX)\n          setItems([]);\n          return;\n\n          // Option B: auto-redirect to create page\n          // router.replace(\"/dashboard/new\");\n          // return;\n        }\n\n        setItems(data);\n      } catch (e: any) {\n        setErr(e?.message ?? \"Failed to load businesses\");\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, [authed, router]);\n\n  // While NextAuth is initializing, render nothing (or a spinner)\n  if (status === \"loading\") {\n    return (\n      <main style={{ padding: 24, maxWidth: 900, margin: \"0 auto\" }}>\n        <p>Loading…</p>\n      </main>\n    );\n  }\n\n  // If not signed in, show login CTA\n  if (!authed) {\n    return (\n      <main style={{ padding: 24, maxWidth: 900, margin: \"0 auto\" }}>\n        <h1 style={{ fontSize: 28, fontWeight: 700 }}>Owner Dashboard</h1>\n        <p style={{ marginTop: 12, color: \"#555\" }}>\n          Please sign in to view your businesses.\n        </p>\n\n        <button\n          onClick={() => signIn(\"google\", { callbackUrl: \"/dashboard\" })}\n          style={{ marginTop: 16, padding: \"10px 14px\", borderRadius: 8, border: \"1px solid #ccc\" }}\n        >\n          Sign in with Google\n        </button>\n      </main>\n    );\n  }\n\n  return (\n    <main style={{ padding: 24, maxWidth: 900, margin: \"0 auto\" }}>\n      <h1 style={{ fontSize: 28, fontWeight: 700 }}>Owner Dashboard</h1>\n\n      <div style={{ marginTop: 18 }}>\n        <Link\n          href=\"/dashboard/new\"\n          style={{\n            display: \"inline-block\",\n            padding: \"10px 14px\",\n            border: \"1px solid #ccc\",\n            borderRadius: 8,\n          }}\n        >\n          + Create a business\n        </Link>\n      </div>\n\n      {err && <p style={{ color: \"crimson\", marginTop: 16 }}>{err}</p>}\n\n      <div style={{ marginTop: 18 }}>\n        {loading ? (\n          <p>Loading businesses…</p>\n        ) : items.length === 0 ? (\n          <p>No businesses yet. Click “Create a business”.</p>\n        ) : (\n          <ul style={{ marginTop: 10, display: \"grid\", gap: 12, padding: 0, listStyle: \"none\" }}>\n            {items.map((b) => (\n              <li key={b.id} className=\"rounded border p-4 hover:bg-gray-50\">\n                <Link href={`/dashboard/${b.id}`} className=\"block\">\n                  <div className=\"font-bold\">{b.name}</div>\n                  <div className=\"text-sm text-gray-600\">\n                    slug: <code>{b.slug}</code> • role: <b>{b.role}</b>\n                  </div>\n                </Link>\n\n                <div className=\"mt-2 flex gap-3 text-sm\">\n                  <Link href={`/dashboard/${b.id}/services`} className=\"underline\">Services</Link>\n                  <Link href={`/dashboard/${b.id}/hours`} className=\"underline\">Hours</Link>\n                  <Link href={`/b/${b.slug}`} target=\"_blank\" className=\"underline\">Public</Link>\n                </div>\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}